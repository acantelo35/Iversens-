import csv
import os
from datetime import datetime

INVENTORY_FILE = 'bakery_inventory.csv'
TIMESTAMP_FILE = 'last_updated.txt'

def load_inventory():
    inventory = {}
    if os.path.exists(INVENTORY_FILE):
        with open(INVENTORY_FILE, mode='r') as file:
            reader = csv.reader(file)
            for row in reader:
                item, quantity = row
                inventory[item] = int(quantity)
    return inventory

def save_inventory(inventory):
    with open(INVENTORY_FILE, mode='w', newline='') as file:
        writer = csv.writer(file)
        for item, quantity in inventory.items():
            writer.writerow([item, quantity])
    with open(TIMESTAMP_FILE, mode='w') as f:
        f.write(datetime.now().strftime("%Y-%m-%d %H:%M:%S"))

def display_inventory(inventory):
    print("\nüì¶ Current Bakery Inventory:")
    if not inventory:
        print("  (Empty ‚Äî time to bake!)")
    for item, quantity in inventory.items():
        print(f"  - {item}: {quantity}")
    show_last_updated()

def show_last_updated():
    if os.path.exists(TIMESTAMP_FILE):
        with open(TIMESTAMP_FILE, 'r') as f:
            timestamp = f.read()
            print(f"\nüïí Last updated: {timestamp}")

def add_stock(inventory):
    item = input("üçû Enter new item name: ").strip().title()
    quantity = int(input("‚ûï Enter quantity to add: "))
    inventory[item] = inventory.get(item, 0) + quantity
    print(f"‚úÖ Added {quantity} to {item}.")

def record_sale(inventory):
    item = input("üí∏ Enter item sold: ").strip().title()
    if item in inventory:
        quantity = int(input("‚ûñ Enter quantity sold: "))
        inventory[item] = max(0, inventory[item] - quantity)
        print(f"‚úÖ Recorded sale of {quantity} {item}(s).")
    else:
        print("‚ö†Ô∏è Item not found in inventory.")

def main():
    inventory = load_inventory()
    while True:
        print("\n====== üßÅ Bakery Inventory Tracker ======")
        print("1Ô∏è‚É£ View Inventory")
        print("2Ô∏è‚É£ Add Stock")
        print("3Ô∏è‚É£ Record Sale")
        print("4Ô∏è‚É£ Save & Exit")
        choice = input("Select an option (1-4): ").strip()

        if choice == '1':
            display_inventory(inventory)
        elif choice == '2':
            add_stock(inventory)
        elif choice == '3':
            record_sale(inventory)
        elif choice == '4':
            save_inventory(inventory)
            print("üíæ Inventory saved. See you next time!")
            break
        else:
            print("‚ùå Invalid option. Please choose 1‚Äì4.")

if __name__ == "__main__":
    main()
